{% extends "tracking/base.html" %}

{% block title %}Meus Pedidos{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto px-4 py-6">
  
  <!-- Header com Avatar -->
  <div class="glass-card rounded-3xl p-6 mb-6 animate-in">
    <div class="flex items-center gap-4">
      <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center text-white font-bold text-2xl shadow-lg shadow-indigo-500/30">
        {{ customer_name|slice:":1"|upper }}
      </div>
      <div class="flex-1">
        <h1 class="text-2xl font-bold text-slate-800">Olá, {{ customer_name|truncatewords:1 }}!</h1>
        <p class="text-slate-500">Acompanhe seus pedidos</p>
      </div>
    </div>
  </div>
  
  <!-- Pedidos Prontos para Retirada (Destaque no Topo) -->
  {% for order in orders %}
    {% if order.delivery_status == 'ready_for_pickup' %}
    <a href="{% url 'tracking_detail' order.code %}" class="block glass-card rounded-3xl overflow-hidden mb-4 animate-in border-2 border-purple-400 shadow-lg shadow-purple-500/20">
      <div class="bg-gradient-to-r from-purple-500 to-violet-600 p-4 text-white">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
            <i data-lucide="package-check" class="w-6 h-6"></i>
          </div>
          <div class="flex-1">
            <p class="text-purple-100 text-xs uppercase tracking-wider">Pronto para Retirada</p>
            <p class="font-bold text-lg">{{ order.code }}</p>
          </div>
          {% if order.pickup_code %}
          <div class="text-right bg-white/20 rounded-xl px-4 py-2">
            <p class="text-purple-100 text-xs">Código</p>
            <p class="font-mono text-2xl font-black tracking-wider">{{ order.pickup_code }}</p>
          </div>
          {% endif %}
        </div>
      </div>
      <div class="p-4 flex items-center justify-between">
        <div class="flex items-center gap-2 text-slate-500 text-sm">
          <i data-lucide="store" class="w-4 h-4"></i>
          {{ order.tenant.name }}
        </div>
        <div class="flex items-center gap-2 text-purple-600 font-semibold text-sm">
          Ver detalhes
          <i data-lucide="arrow-right" class="w-4 h-4"></i>
        </div>
      </div>
    </a>
    {% endif %}
  {% endfor %}
  
  <!-- Título da Lista -->
  <h3 class="text-white font-semibold mb-3 flex items-center gap-2 mt-6">
    <i data-lucide="package" class="w-5 h-5"></i>
    Todos os Pedidos
  </h3>
  
  <!-- Lista de Pedidos -->
  <div class="space-y-3">
    {% for order in orders %}
    {% if order.delivery_status != 'ready_for_pickup' %}
    <a href="{% url 'tracking_detail' order.code %}" class="block glass-card rounded-2xl p-4 hover:shadow-lg transition-all animate-in">
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl flex items-center justify-center
            {% if order.order_status == 'cancelled' or order.order_status == 'returned' %}bg-red-100
            {% elif order.delivery_status == 'delivered' or order.delivery_status == 'picked_up' %}bg-emerald-100
            {% elif order.delivery_status == 'shipped' %}bg-blue-100
            {% elif order.delivery_status == 'failed_attempt' %}bg-orange-100
            {% else %}bg-amber-100{% endif %}">
            {% if order.order_status == 'cancelled' or order.order_status == 'returned' %}
              <i data-lucide="x-circle" class="w-5 h-5 text-red-600"></i>
            {% elif order.delivery_status == 'delivered' or order.delivery_status == 'picked_up' %}
              <i data-lucide="check-circle" class="w-5 h-5 text-emerald-600"></i>
            {% elif order.delivery_status == 'shipped' %}
              <i data-lucide="truck" class="w-5 h-5 text-blue-600"></i>
            {% elif order.delivery_status == 'failed_attempt' %}
              <i data-lucide="alert-triangle" class="w-5 h-5 text-orange-600"></i>
            {% else %}
              <i data-lucide="clock" class="w-5 h-5 text-amber-600"></i>
            {% endif %}
          </div>
          <div>
            <p class="font-mono text-sm font-bold text-slate-800">{{ order.code }}</p>
            <p class="text-xs text-slate-500">{{ order.created_at|date:"d/m/Y H:i" }}</p>
          </div>
        </div>
        
        {% if order.order_status == 'cancelled' or order.order_status == 'returned' %}
          <span class="px-3 py-1 bg-red-100 text-red-700 rounded-full text-xs font-semibold">
            {% if order.order_status == 'cancelled' %}Cancelado{% else %}Devolvido{% endif %}
          </span>
        {% elif order.delivery_status == 'delivered' or order.delivery_status == 'picked_up' %}
          <span class="px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-xs font-semibold">
            {% if order.delivery_status == 'delivered' %}Entregue{% else %}Retirado{% endif %}
          </span>
        {% elif order.delivery_status == 'shipped' %}
          <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-semibold">Em Trânsito</span>
        {% elif order.delivery_status == 'expired' %}
          <span class="px-3 py-1 bg-red-100 text-red-700 rounded-full text-xs font-semibold">Expirado</span>
        {% elif order.delivery_status == 'failed_attempt' %}
          <span class="px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-xs font-semibold">Tentativa {{ order.delivery_attempts }}</span>
        {% else %}
          <span class="px-3 py-1 bg-amber-100 text-amber-700 rounded-full text-xs font-semibold">Processando</span>
        {% endif %}
      </div>
      
      <div class="flex items-center justify-between text-sm border-t border-slate-100 pt-3">
        <div class="flex items-center gap-3 text-slate-500">
          <span class="flex items-center gap-1">
            <i data-lucide="store" class="w-4 h-4"></i>
            {{ order.tenant.name|truncatewords:3 }}
          </span>
          <span class="font-semibold text-slate-700">R$ {{ order.total_value|floatformat:2 }}</span>
        </div>
        <i data-lucide="chevron-right" class="w-5 h-5 text-slate-300"></i>
      </div>
    </a>
    {% endif %}
    {% empty %}
    <div class="glass-card rounded-3xl p-10 text-center">
      <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <i data-lucide="package-x" class="w-10 h-10 text-slate-400"></i>
      </div>
      <h3 class="font-bold text-slate-700 text-lg mb-2">Nenhum pedido encontrado</h3>
      <p class="text-slate-500">Seus pedidos aparecerão aqui quando você fizer compras</p>
    </div>
    {% endfor %}
  </div>
  
  <!-- Link para Busca -->
  <div class="mt-8 text-center">
    <a href="{% url 'tracking_search' %}" class="inline-flex items-center gap-2 text-slate-400 hover:text-white transition-colors">
      <i data-lucide="search" class="w-4 h-4"></i>
      Buscar pedido por código
    </a>
  </div>
  
</div>
{% endblock %}
