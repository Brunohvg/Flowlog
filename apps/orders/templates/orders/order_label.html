<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Etiqueta {{ order.code }}</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', Arial, sans-serif; background: #f0f0f0; }
    
    /* Controles */
    .no-print {
      background: #1e293b; color: white; padding: 12px 20px;
      display: flex; align-items: center; justify-content: space-between;
    }
    .no-print h1 { font-size: 16px; }
    .size-selector { display: flex; gap: 6px; }
    .size-btn {
      padding: 6px 12px; font-size: 12px; font-weight: 600;
      border: 2px solid #475569; background: transparent; color: #94a3b8;
      border-radius: 6px; cursor: pointer;
    }
    .size-btn.active { background: #6366f1; border-color: #6366f1; color: white; }
    .btn { padding: 8px 16px; font-size: 13px; font-weight: 600; border-radius: 6px; border: none; cursor: pointer; }
    .btn-print { background: #6366f1; color: #fff; }
    .btn-back { background: #475569; color: #fff; margin-left: 8px; }
    
    /* Container da etiqueta */
    .label-wrapper {
      padding: 20px;
      display: flex;
      justify-content: center;
    }
    
    /* Etiqueta */
    .label {
      background: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      overflow: hidden;
      position: relative;
    }
    
    /* Tamanhos */
    .label.size-quarter { width: 105mm; min-height: 100mm; }
    .label.size-compact { width: 100mm; min-height: 80mm; }
    
    /* Header */
    .header {
      padding: 8px 10px; color: #fff;
      display: flex; align-items: center; justify-content: space-between;
    }
    .header.motoboy { background: linear-gradient(135deg, #3b82f6, #1e40af); }
    .header.sedex { background: linear-gradient(135deg, #ef4444, #b91c1c); }
    .header.pac { background: linear-gradient(135deg, #10b981, #047857); }
    .header.pickup { background: linear-gradient(135deg, #8b5cf6, #6d28d9); }
    
    .header-left { display: flex; align-items: center; gap: 6px; }
    .header .icon { font-size: 14px; }
    .header .type { font-size: 11px; font-weight: 700; text-transform: uppercase; }
    .header .code { font-size: 16px; font-weight: 900; font-family: monospace; letter-spacing: 1px; }
    
    /* Body */
    .body { padding: 10px; }
    
    /* Grid */
    .row { display: flex; gap: 8px; margin-bottom: 8px; }
    .col { flex: 1; background: #f8fafc; border-radius: 4px; padding: 8px; }
    
    .lbl { font-size: 8px; text-transform: uppercase; color: #64748b; font-weight: 700; }
    .val { font-size: 12px; font-weight: 600; color: #1e293b; margin-top: 2px; }
    .val.big { font-size: 16px; font-weight: 900; }
    .val.phone { font-size: 11px; color: #475569; margin-top: 4px; }
    
    /* Badge */
    .badge { display: inline-block; padding: 3px 8px; font-size: 9px; font-weight: 700; border-radius: 10px; margin-top: 4px; }
    .badge.paid { background: #dcfce7; color: #166534; }
    .badge.pending { background: #fef3c7; color: #92400e; }
    
    /* Pickup */
    .pickup-box { background: #faf5ff; border: 2px solid #a855f7; border-radius: 6px; padding: 10px; text-align: center; margin-bottom: 8px; }
    .pickup-box .lbl { color: #7c3aed; }
    .pickup-box .code { font-size: 32px; font-weight: 900; font-family: monospace; letter-spacing: 6px; color: #1e293b; margin: 4px 0; }
    .pickup-box .qr img { width: 60px; height: 60px; }
    
    /* Endere√ßo */
    .addr { background: #f8fafc; border-radius: 4px; padding: 8px; margin-bottom: 8px; }
    .addr .text { font-size: 10px; color: #334155; line-height: 1.4; }
    
    /* Rastreio */
    .track { background: #eef2ff; border: 1px solid #6366f1; border-radius: 4px; padding: 6px; text-align: center; margin-bottom: 8px; }
    .track .code { font-size: 13px; font-weight: 700; font-family: monospace; color: #3730a3; }
    
    /* Obs */
    .notes { background: #fffbeb; border-left: 3px solid #f59e0b; padding: 6px 8px; margin-bottom: 8px; }
    .notes .text { font-size: 9px; color: #92400e; }
    
    /* Footer */
    .footer { padding: 6px 10px; background: #f1f5f9; display: flex; justify-content: space-between; font-size: 9px; color: #64748b; border-top: 1px solid #e2e8f0; }
    
    /* ========== PRINT ========== */
    @media print {
      @page { size: A4; margin: 10mm; }
      
      body { background: white !important; }
      .no-print { display: none !important; }
      .label-wrapper { padding: 0 !important; justify-content: flex-start !important; }
      .label { box-shadow: none !important; border: 1px solid #ddd; }
    }
  </style>
</head>
<body>
  
  <!-- Controles - n√£o imprime -->
  <div class="no-print">
    <h1>üè∑Ô∏è {{ order.code }}</h1>
    <div style="display:flex;align-items:center;gap:12px;">
      <div class="size-selector">
        <button class="size-btn active" data-size="quarter">1/4 A4</button>
        <button class="size-btn" data-size="compact">10√ó10</button>
      </div>
      <button class="btn btn-print" onclick="window.print()">üñ®Ô∏è Imprimir</button>
      <button class="btn btn-back" onclick="window.close()">‚Üê Voltar</button>
    </div>
  </div>
  
  <!-- Etiqueta -->
  <div class="label-wrapper">
    <div class="label size-quarter" id="label">
      
      <!-- Header -->
      <div class="header {{ order.delivery_type }}">
        <div class="header-left">
          <span class="icon">{% if order.delivery_type == 'motoboy' %}üèçÔ∏è{% elif order.delivery_type == 'sedex' %}‚ö°{% elif order.delivery_type == 'pac' %}üì¶{% else %}üè¨{% endif %}</span>
          <span class="type">{{ order.get_delivery_type_display }}</span>
        </div>
        <span class="code">{{ order.code }}</span>
      </div>
      
      <!-- Body -->
      <div class="body">
        
        <!-- Cliente + Valor -->
        <div class="row">
          <div class="col">
            <div class="lbl">Cliente</div>
            <div class="val">{{ order.customer.name }}</div>
            <div class="val phone">üì± {{ order.customer.phone }}</div>
          </div>
          <div class="col" style="text-align:center;">
            <div class="lbl">Valor</div>
            <div class="val big">R$ {{ order.total_value|floatformat:2 }}</div>
            <span class="badge {% if order.payment_status == 'paid' %}paid{% else %}pending{% endif %}">
              {% if order.payment_status == 'paid' %}‚úì PAGO{% else %}PENDENTE{% endif %}
            </span>
          </div>
        </div>
        
        <!-- C√≥digo de Retirada (se pickup) -->
        {% if order.delivery_type == 'pickup' %}
        <div class="pickup-box">
          <div class="lbl">C√≥digo de Retirada</div>
          <div class="code">{{ order.pickup_code|default:"----" }}</div>
          <div class="qr"><img src="https://api.qrserver.com/v1/create-qr-code/?size=60x60&data={{ order.code }}" alt="QR"></div>
        </div>
        {% endif %}
        
        <!-- Endere√ßo (se entrega) -->
        {% if order.delivery_type != 'pickup' and order.delivery_address %}
        <div class="addr">
          <div class="lbl">Endere√ßo de Entrega</div>
          <div class="text">{{ order.delivery_address }}</div>
        </div>
        {% endif %}
        
        <!-- Rastreio -->
        {% if order.tracking_code %}
        <div class="track">
          <div class="lbl">Rastreio</div>
          <div class="code">{{ order.tracking_code }}</div>
        </div>
        {% endif %}
        
        <!-- Observa√ß√µes -->
        {% if order.notes %}
        <div class="notes">
          <div class="lbl">Obs</div>
          <div class="text">{{ order.notes|truncatewords:20 }}</div>
        </div>
        {% endif %}
        
      </div>
      
      <!-- Footer -->
      <div class="footer">
        <span>{{ order.created_at|date:"d/m/Y H:i" }}</span>
        <span>{{ request.tenant.name }}</span>
      </div>
      
    </div>
  </div>
  
  <script>
    document.querySelectorAll('.size-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('label').className = 'label size-' + btn.dataset.size;
      });
    });
  </script>
</body>
</html>
