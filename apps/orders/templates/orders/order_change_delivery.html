{% extends "base/base.html" %}
{% load flowlog_tags %}

{% block title %}Alterar Entrega - Flowlog{% endblock %}
{% block page_title %}Alterar Tipo de Entrega{% endblock %}
{% block page_subtitle %}{{ order.code }}{% endblock %}

{% block content %}

<div class="max-w-xl mx-auto">

  <div class="mb-6">
    <a href="{% url 'order_detail' order.id %}" class="btn btn-secondary btn-sm">
      <i data-lucide="arrow-left" class="w-4 h-4"></i> Voltar
    </a>
  </div>

  <!-- Info Atual -->
  <div class="card p-5 mb-6">
    <div class="flex items-center gap-4">
      <div class="w-12 h-12 rounded-xl flex items-center justify-center
        {% if order.delivery_type == 'pickup' %}bg-amber-100{% elif order.delivery_type == 'motoboy' %}bg-blue-100{% else %}bg-emerald-100{% endif %}">
        {% if order.delivery_type == 'pickup' %}
          <i data-lucide="store" class="w-6 h-6 text-amber-600"></i>
        {% elif order.delivery_type == 'motoboy' %}
          <i data-lucide="bike" class="w-6 h-6 text-blue-600"></i>
        {% else %}
          <i data-lucide="package" class="w-6 h-6 text-emerald-600"></i>
        {% endif %}
      </div>
      <div>
        <p class="text-xs text-slate-500">Tipo Atual</p>
        <p class="font-bold text-slate-800">{{ order.get_delivery_type_display }}</p>
      </div>
    </div>
  </div>

  <!-- Form -->
  <form method="post" class="card p-6">
    {% csrf_token %}

    <div class="mb-5">
      <label class="form-label">Novo Tipo de Entrega</label>
      <select name="delivery_type" id="delivery_type" class="form-select">
        <option value="motoboy" {% if order.delivery_type == 'motoboy' %}selected{% endif %}>ğŸï¸ Motoboy</option>
        <option value="sedex" {% if order.delivery_type == 'sedex' %}selected{% endif %}>âš¡ SEDEX (Correios)</option>
        <option value="pac" {% if order.delivery_type == 'pac' %}selected{% endif %}>ğŸ“¦ PAC (Correios)</option>
        <option value="mandae" {% if order.delivery_type == 'mandae' %}selected{% endif %}>ğŸš› MandaÃª</option>
        <option value="pickup" {% if order.delivery_type == 'pickup' %}selected{% endif %}>ğŸ¬ Retirada na Loja</option>
      </select>
    </div>

    <div id="address-section" class="mb-5 {% if order.delivery_type == 'pickup' %}hidden{% endif %}">
      <label class="form-label">EndereÃ§o de Entrega</label>
      <textarea name="delivery_address" rows="4" class="form-textarea" placeholder="EndereÃ§o completo...">{{ order.delivery_address }}</textarea>
      <p class="text-xs text-slate-500 mt-2">ObrigatÃ³rio para entregas</p>
    </div>

    <div class="flex gap-3">
      <a href="{% url 'order_detail' order.id %}" class="btn btn-secondary">Cancelar</a>
      <button type="submit" class="btn btn-primary flex-1">
        <i data-lucide="check" class="w-4 h-4"></i> Alterar
      </button>
    </div>
  </form>

</div>

{% endblock %}

{% block scripts %}
<script>
  const deliveryType = document.getElementById('delivery_type');
  const addressSection = document.getElementById('address-section');

  deliveryType.addEventListener('change', function() {
    addressSection.classList.toggle('hidden', this.value === 'pickup');
  });
</script>
{% endblock %}
